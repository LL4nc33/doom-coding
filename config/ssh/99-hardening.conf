# Doom Coding SSH Hardening Configuration
# Drop-in config for /etc/ssh/sshd_config.d/
# Based on Mozilla Modern SSH Guidelines

# ============================================
# AUTHENTICATION
# ============================================

# Disable root login - use sudo instead
PermitRootLogin no

# Disable password authentication - keys only
PasswordAuthentication no
PermitEmptyPasswords no

# Enable public key authentication
PubkeyAuthentication yes
AuthenticationMethods publickey

# Limit authentication attempts
MaxAuthTries 3
MaxSessions 10

# ============================================
# SECURITY RESTRICTIONS
# ============================================

# Disable X11 forwarding (security risk)
X11Forwarding no

# Disable TCP forwarding (unless explicitly needed)
AllowTcpForwarding no
GatewayPorts no

# Disable agent forwarding
AllowAgentForwarding no

# Disable tunneling
PermitTunnel no

# Disable user environment
PermitUserEnvironment no

# ============================================
# CRYPTOGRAPHY (Mozilla Modern)
# ============================================

# Key Exchange Algorithms
KexAlgorithms curve25519-sha256@libssh.org,curve25519-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512

# Ciphers (AEAD only)
Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com

# Message Authentication Codes
MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com

# Host Key Algorithms
HostKeyAlgorithms ssh-ed25519,rsa-sha2-512,rsa-sha2-256

# ============================================
# TIMEOUTS & LIMITS
# ============================================

# Client keepalive
ClientAliveInterval 300
ClientAliveCountMax 2

# Login grace time
LoginGraceTime 30

# ============================================
# LOGGING
# ============================================

# Verbose logging for security auditing
LogLevel VERBOSE

# ============================================
# MISC
# ============================================

# Disable DNS lookups (faster connections)
UseDNS no

# Print last login info
PrintLastLog yes

# Strict modes for file permissions
StrictModes yes

# Note: UsePrivilegeSeparation is deprecated since OpenSSH 7.5+
# Privilege separation is now always enabled by default
